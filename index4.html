<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Migraine Logger v2.6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Dark, migraine-friendly blue-gray gradient background */
        body {
            background: linear-gradient(120deg, #0d1b2a, #1b263b, #415a77, #778da9);
            background-size: 300% 300%;
            animation: gradientBG 25s ease infinite;
            font-family: 'Inter', sans-serif;
        }

        /* Low stimulus mode: simpler background and no animation */
        body.low-stimulus {
            background: #1b263b !important;
            animation: none !important;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Frosty glass-card style */
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* Tab button styling */
        .tab-btn {
            @apply inline-block px-4 py-2 border-b-2 font-medium text-sm cursor-pointer;
        }

        .tab-btn.active {
            @apply border-blue-400 text-blue-300;
        }

        .tab-btn.inactive {
            @apply border-transparent hover:text-blue-300;
        }

        /* Consistent Pill Styling for Meds, Triggers, and Aura Types */
        .pill {
            @apply px-3 py-1 rounded-full text-xs font-medium border border-white/30 cursor-pointer transition duration-200;
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .pill:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .pill.selected {
            @apply bg-blue-700 text-white border-transparent;
        }

        /* Log card styling for History page */
        .log-card {
            @apply bg-white/10 p-4 rounded-md shadow-md border border-white/30 mb-4;
        }

        .log-card-header {
            @apply flex justify-between items-center mb-2;
        }

        .log-type {
            @apply text-xs px-2 py-1 rounded;
        }

        /* Chart container styling */
        .chart-container {
            @apply bg-white/10 p-4 rounded-md;
        }

        /* Custom range slider styling */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #415a77;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #778da9;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #778da9;
            cursor: pointer;
        }

        /* Modal backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.6);
        }

        /* Landing page state */
        #landingPage {
            position: fixed;
            inset: 0;
            z-index: 1000;
            transition: opacity 0.3s ease-in-out;
        }

        #landingPage.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Main app state */
        #mainApp {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #mainApp.visible {
            opacity: 1;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- Landing Page -->
    <div id="landingPage" class="flex items-center justify-center p-4">
        <div class="max-w-3xl w-full bg-white/10 p-8 rounded-xl shadow-xl glass-card">
            <h1 class="text-4xl font-bold text-center text-white mb-8">Migraine Logger v2.6</h1>
            <div class="flex flex-col gap-4">
                <button
                    class="w-full h-16 bg-blue-700 hover:bg-blue-600 text-2xl font-bold rounded-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-400 text-white"
                    onclick="logQuickEpisode()">Quick Log</button>
                <button
                    class="w-full h-16 bg-green-700 hover:bg-green-600 text-2xl font-bold rounded-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-green-400 text-white"
                    onclick="startAdvancedLog()">Advanced Log</button>
                <button
                    class="w-full h-16 bg-purple-700 hover:bg-purple-600 text-2xl font-bold rounded-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-400 text-white"
                    onclick="startHistory()">History</button>
                <button
                    class="w-full h-16 bg-indigo-700 hover:bg-indigo-600 text-2xl font-bold rounded-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-indigo-400 text-white"
                    onclick="startAnalytics()">Analytics</button>
            </div>
            <p class="mt-8 text-center text-white text-xl">Select your desired logging mode or view your data.</p>
        </div>
    </div>

    <!-- Main Application (initially hidden) -->
    <div id="mainApp" class="min-h-screen text-white flex items-center justify-center p-4">
        <div class="max-w-4xl w-full glass-card rounded-xl shadow-xl p-6 flex flex-col relative">
            <!-- Back to Home Button -->
            <button id="backHome"
                class="absolute top-4 left-4 bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded focus:outline-none"
                onclick="goHome()">Home</button>
            <!-- Settings Icon -->
            <button id="openSettings" class="absolute top-4 right-4 focus:outline-none" title="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-300 hover:text-blue-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0a1.724 1.724 0 002.573 1.066c.788-.57 1.87.163 1.54 1.043a1.724 1.724 0 001.066 2.573c.921.3.921 1.603 0 1.902a1.724 1.724 0 00-1.066 2.573c.33.88-.752 1.613-1.54 1.043a1.724 1.724 0 00-2.573 1.066c-.3.921-1.603.921-1.902 0a1.724 1.724 0 00-2.573-1.066c-.788.57-1.87-.163-1.54-1.043a1.724 1.724 0 00-1.066-2.573c-.921-.3-.921-1.603 0-1.902a1.724 1.724 0 001.066-2.573c-.33-.88.752-1.613 1.54-1.043.986.714 2.44.337 2.573-1.066z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
            <h1 class="text-3xl font-extrabold text-center mb-4">Migraine Logger v2.6</h1>
            <!-- Tabs Navigation -->
            <div class="flex justify-center gap-4 mb-6 border-b border-white/20">
                <button class="tab-btn active" data-target="advancedTab"
                    onclick="activateTab('advancedTab')">Advanced</button>
                <button class="tab-btn inactive" data-target="historyTab"
                    onclick="activateTab('historyTab')">History</button>
                <button class="tab-btn inactive" data-target="analyticsTab"
                    onclick="activateTab('analyticsTab')">Analytics</button>
            </div>
            <!-- Tab Content -->
            <!-- Advanced Tab -->
            <div id="advancedTab" class="tab-content">
                <p class="mb-2">Enter detailed information for this episode.</p>
                <!-- Date/Time -->
                <div>
                    <label for="dateTime" class="block mb-1">Date/Time</label>
                    <input id="dateTime" type="datetime-local"
                        class="w-full p-2 rounded-md bg-white/20 border-none outline-none backdrop-blur-sm" />
                </div>
                <!-- Pain Intensity -->
                <div>
                    <label for="painSlider" class="block mb-1">Pain Intensity (1-10)</label>
                    <input type="range" id="painSlider" min="1" max="10" value="5" class="w-full">
                    <p id="painValue" class="text-center mt-1">5</p>
                </div>
                <!-- Aura Details -->
                <div class="border-t border-white/20 pt-4">
                    <p class="mb-2 font-semibold">Aura-Specific Logging</p>
                    <!-- Aura Types -->
                    <div>
                        <p class="mb-1">Select Aura Type(s)</p>
                        <div class="flex flex-wrap gap-2" id="auraPills">
                            <span class="pill" data-aura="Flashing Lights">Flashing Lights</span>
                            <span class="pill" data-aura="Zigzag Patterns">Zigzag Patterns</span>
                            <span class="pill" data-aura="Blind Spots">Blind Spots</span>
                            <span class="pill" data-aura="Other">Other</span>
                        </div>
                        <!-- Selected Aura Types Field -->
                        <div id="selectedAuraContainer" class="flex flex-wrap gap-2 mt-2"></div>
                    </div>
                    <!-- Aura Duration Slider -->
                    <div>
                        <label for="auraDuration" class="block mb-1">Aura Duration (minutes, 0-60)</label>
                        <input id="auraDuration" type="range" min="0" max="60" value="0" class="w-full">
                        <p id="auraDurationValue" class="text-center mt-1">0</p>
                    </div>
                    <!-- Aura Description -->
                    <div>
                        <label for="auraDescription" class="block mb-1">Aura Description</label>
                        <textarea id="auraDescription" rows="3"
                            placeholder="Describe visual distortions (e.g., flashing lights, zigzag patterns)"
                            class="w-full p-2 rounded-md bg-white/20 border-none outline-none"></textarea>
                    </div>
                    <!-- Aura Followed by Headache -->
                    <div class="flex items-center gap-2">
                        <input id="auraHeadache" type="checkbox" class="form-checkbox text-blue-600">
                        <label for="auraHeadache">Aura followed by headache?</label>
                    </div>
                </div>
                <!-- Medications -->
                <div>
                    <p class="mb-1">Select Medication(s) Taken</p>
                    <div class="flex flex-wrap gap-2" id="medPills">
                        <span class="pill" data-med="Ibuprofen">Ibuprofen</span>
                        <span class="pill" data-med="Acetaminophen">Acetaminophen</span>
                        <span class="pill" data-med="Aspirin">Aspirin</span>
                        <span class="pill" data-med="Triptan">Triptan</span>
                        <span class="pill" data-med="None">None</span>
                    </div>
                    <!-- Selected Medications Field -->
                    <div id="selectedMedsContainer" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <!-- Triggers -->
                <div>
                    <p class="mb-1">Select Trigger(s)</p>
                    <div class="flex flex-wrap gap-2" id="triggerPills">
                        <span class="pill" data-trigger="Bright Light">Bright Light</span>
                        <span class="pill" data-trigger="Stress">Stress</span>
                        <span class="pill" data-trigger="Noise">Noise</span>
                        <span class="pill" data-trigger="Food">Food</span>
                        <span class="pill" data-trigger="Other">Other</span>
                    </div>
                    <!-- Selected Triggers Field -->
                    <div id="selectedTriggersContainer" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <!-- Save Advanced Log Button -->
                <div class="mt-4">
                    <button
                        class="px-4 py-2 w-full rounded-md bg-blue-700 hover:bg-blue-600 text-sm font-semibold border border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
                        onclick="saveAdvancedLog()">Save Advanced Log</button>
                </div>
            </div>
            <!-- History Tab -->
            <div id="historyTab" class="hidden tab-content flex flex-col gap-4">
                <p class="font-semibold text-xl mb-2">Recent Logs</p>
                <div id="logHistory" class="flex flex-col gap-3">
                    <!-- Log entries will be appended here as cards -->
                </div>
                <div class="flex flex-col gap-4 mt-4">
                    <div class="chart-container">
                        <p class="mb-1">Pain Intensity (Last 7 Logs)</p>
                        <div id="barChart" class="flex items-end h-16 gap-1">
                            <!-- Bars appended dynamically -->
                        </div>
                    </div>
                    <div class="chart-container">
                        <p class="mb-1">Aura Timeline (Last 7 Logs)</p>
                        <div id="auraTimeline" class="flex items-end h-16 gap-1">
                            <!-- Aura markers appended dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Analytics Tab -->
            <div id="analyticsTab" class="hidden tab-content flex flex-col gap-4">
                <p class="mb-2 font-semibold text-xl">Analytics Dashboard</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="p-4 bg-blue-700 rounded shadow">
                        <p class="text-2xl font-bold">Total Logs</p>
                        <p id="totalLogs" class="text-xl">0</p>
                    </div>
                    <div class="p-4 bg-green-700 rounded shadow">
                        <p class="text-2xl font-bold">Quick Logs</p>
                        <p id="quickLogs" class="text-xl">0</p>
                    </div>
                    <div class="p-4 bg-purple-700 rounded shadow">
                        <p class="text-2xl font-bold">Advanced Logs</p>
                        <p id="advancedLogs" class="text-xl">0</p>
                    </div>
                    <div class="p-4 bg-indigo-700 rounded shadow">
                        <p class="text-2xl font-bold">Aura Events</p>
                        <p id="auraEvents" class="text-xl">0</p>
                    </div>
                    <div class="p-4 bg-red-700 rounded shadow">
                        <p class="text-2xl font-bold">Avg Pain (Adv)</p>
                        <p id="avgPain" class="text-xl">N/A</p>
                    </div>
                </div>
                <div class="mt-6">
                    <h2 class="text-2xl font-bold mb-2">Advanced Analytics</h2>
                    <ul class="list-disc ml-6">
                        <li><strong>Correlation Matrix:</strong> Analyze data from aura logs, sleep patterns, weather,
                            stress, and dietary inputs to reveal your strongest migraine triggers.</li>
                        <li><strong>Medication Efficacy Dashboard:</strong> Track medications taken alongside migraine
                            severity and duration. View trends and average pain reduction per treatment.</li>
                        <li><strong>Shareable Reports:</strong> Generate detailed reports that focus on
                            migraine-specific factors (aura, medication response, common incident times, etc.) for
                            discussion with your healthcare provider.</li>
                    </ul>
                    <button class="mt-4 px-4 py-2 rounded bg-green-600 hover:bg-green-500 text-white"
                        onclick="generateReport()">Generate Detailed Report</button>
                    <div id="detailedReport" class="mt-4 p-4 bg-white/10 rounded"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 flex items-center justify-center hidden z-50">
        <div class="absolute inset-0 modal-backdrop"></div>
        <div class="relative glass-card rounded-xl p-6 max-w-sm w-full">
            <h2 class="text-2xl font-bold mb-4">Default Settings</h2>
            <div class="mb-4">
                <label for="defaultPain" class="block mb-1">Default Pain Intensity (1-10)</label>
                <input id="defaultPain" type="range" min="1" max="10" value="5" class="w-full">
                <p id="defaultPainValue" class="text-center mt-1">5</p>
            </div>
            <div class="mb-4">
                <p class="mb-1">Default Medication</p>
                <div class="flex flex-wrap gap-2" id="defaultMedPills">
                    <span class="pill" data-med="Ibuprofen">Ibuprofen</span>
                    <span class="pill" data-med="Acetaminophen">Acetaminophen</span>
                    <span class="pill" data-med="Aspirin">Aspirin</span>
                    <span class="pill" data-med="Triptan">Triptan</span>
                    <span class="pill" data-med="None">None</span>
                </div>
            </div>
            <div class="mb-4">
                <label class="inline-flex items-center">
                    <input id="lowStimulusMode" type="checkbox" class="form-checkbox text-blue-600">
                    <span class="ml-2">Enable Low Stimulus Mode</span>
                </label>
            </div>
            <div class="flex justify-end gap-2">
                <button class="px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm"
                    onclick="closeSettings()">Cancel</button>
                <button class="px-4 py-2 rounded-md bg-blue-700 hover:bg-blue-600 text-sm font-semibold"
                    onclick="saveDefaultSettings()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Global log storage for analytics
        let logEntries = [];
        // Pre-configured defaults
        let defaultPain = 5;
        let defaultMed = "None";
        let lowStimulusEnabled = false;
        // For default medication selection in settings modal
        let selectedDefaultMed = "";

        // Helper function to activate a tab in the main app
        function activateTab(tabId) {
            document.querySelectorAll(".tab-btn").forEach(btn => {
                btn.classList.remove("active");
                btn.classList.add("inactive");
            });
            let tabButton = document.querySelector(`[data-target="${tabId}"]`);
            tabButton.classList.add("active");
            tabButton.classList.remove("inactive");
            document.querySelectorAll(".tab-content").forEach(tc => tc.classList.add("hidden"));
            document.getElementById(tabId).classList.remove("hidden");
            if (tabId === "analyticsTab") {
                updateAnalyticsDashboard();
            }
        }

        // Landing page navigation functions
        function logQuickEpisode() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const logEntry = {
                time: timeString,
                meds: defaultMed,
                quick: true,
                aura: "Aura logged."
            };
            addLogEntry(logEntry);
            updateChart(0, true);
            alert("Quick aura log saved using your default meds!");
        }

        function startAdvancedLog() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('visible');
            activateTab('advancedTab');
        }

        function startHistory() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('visible');
            activateTab('historyTab');
        }

        function startAnalytics() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('visible');
            activateTab('analyticsTab');
        }

        // Back to Home function for main app
        function goHome() {
            document.getElementById('mainApp').classList.remove('visible');
            document.getElementById('landingPage').classList.remove('hidden');
        }

        document.getElementById("openSettings").addEventListener("click", () => {
            document.getElementById("settingsModal").classList.remove("hidden");
        });

        function closeSettings() {
            document.getElementById("settingsModal").classList.add("hidden");
        }

        function saveDefaultSettings() {
            const painInput = document.getElementById("defaultPain").value;
            defaultPain = painInput ? painInput : 5;
            defaultMed = selectedDefaultMed || defaultMed;
            lowStimulusEnabled = document.getElementById("lowStimulusMode").checked;
            if (lowStimulusEnabled) {
                document.body.classList.add("low-stimulus");
            } else {
                document.body.classList.remove("low-stimulus");
            }
            document.getElementById("defaultPainValue").textContent = defaultPain;
            alert("Default settings saved!");
            closeSettings();
        }

        document.getElementById("defaultPain").addEventListener("input", (e) => {
            document.getElementById("defaultPainValue").textContent = e.target.value;
        });

        // Preselect "None" as default medication on page load
        document.addEventListener("DOMContentLoaded", function () {
            const defaultMedPills = document.querySelectorAll("#defaultMedPills .pill");
            defaultMedPills.forEach(pill => {
                if (pill.dataset.med === "None") {
                    pill.classList.add("selected");
                    selectedDefaultMed = "None";
                }
            });
        });

        // Handle medication pills selection in Advanced tab
        let selectedMeds = [];
        function updateSelectedMeds() {
            const container = document.getElementById("selectedMedsContainer");
            container.innerHTML = "";
            selectedMeds.forEach(med => {
                const pill = document.createElement("span");
                pill.className = "pill selected";
                pill.textContent = med + " ✕";
                pill.dataset.med = med;
                pill.addEventListener("click", () => {
                    selectedMeds = selectedMeds.filter(m => m !== med);
                    updateSelectedMeds();
                    document.querySelectorAll("#medPills .pill").forEach(el => {
                        if (el.dataset.med === med) {
                            el.classList.remove("selected");
                        }
                    });
                });
                container.appendChild(pill);
            });
        }
        document.querySelectorAll("#medPills .pill").forEach(pill => {
            pill.addEventListener("click", () => {
                const med = pill.dataset.med;
                if (selectedMeds.includes(med)) {
                    selectedMeds = selectedMeds.filter(m => m !== med);
                    pill.classList.remove("selected");
                } else {
                    selectedMeds.push(med);
                    pill.classList.add("selected");
                }
                updateSelectedMeds();
            });
        });

        // Handle trigger pills selection in Advanced tab
        let selectedTriggers = [];
        function updateSelectedTriggers() {
            const container = document.getElementById("selectedTriggersContainer");
            container.innerHTML = "";
            selectedTriggers.forEach(trigger => {
                const pill = document.createElement("span");
                pill.className = "pill selected";
                pill.textContent = trigger + " ✕";
                pill.dataset.trigger = trigger;
                pill.addEventListener("click", () => {
                    selectedTriggers = selectedTriggers.filter(t => t !== trigger);
                    updateSelectedTriggers();
                    document.querySelectorAll("#triggerPills .pill").forEach(el => {
                        if (el.dataset.trigger === trigger) {
                            el.classList.remove("selected");
                        }
                    });
                });
                container.appendChild(pill);
            });
        }
        document.querySelectorAll("#triggerPills .pill").forEach(pill => {
            pill.addEventListener("click", () => {
                const trigger = pill.dataset.trigger;
                if (selectedTriggers.includes(trigger)) {
                    selectedTriggers = selectedTriggers.filter(t => t !== trigger);
                    pill.classList.remove("selected");
                } else {
                    selectedTriggers.push(trigger);
                    pill.classList.add("selected");
                }
                updateSelectedTriggers();
            });
        });

        // Handle aura pills selection in Advanced tab
        let selectedAuraTypes = [];
        function updateSelectedAura() {
            const container = document.getElementById("selectedAuraContainer");
            container.innerHTML = "";
            selectedAuraTypes.forEach(aura => {
                const pill = document.createElement("span");
                pill.className = "pill selected";
                pill.textContent = aura + " ✕";
                pill.dataset.aura = aura;
                pill.addEventListener("click", () => {
                    selectedAuraTypes = selectedAuraTypes.filter(a => a !== aura);
                    updateSelectedAura();
                    document.querySelectorAll("#auraPills .pill").forEach(el => {
                        if (el.dataset.aura === aura) {
                            el.classList.remove("selected");
                        }
                    });
                });
                container.appendChild(pill);
            });
        }
        document.querySelectorAll("#auraPills .pill").forEach(pill => {
            pill.addEventListener("click", () => {
                const aura = pill.dataset.aura;
                if (selectedAuraTypes.includes(aura)) {
                    selectedAuraTypes = selectedAuraTypes.filter(a => a !== aura);
                    pill.classList.remove("selected");
                } else {
                    selectedAuraTypes.push(aura);
                    pill.classList.add("selected");
                }
                updateSelectedAura();
            });
        });

        // Pain slider update
        const painSlider = document.getElementById("painSlider");
        const painValue = document.getElementById("painValue");
        painSlider.addEventListener("input", (e) => {
            painValue.textContent = e.target.value;
        });

        // Aura duration slider update
        const auraDurationSlider = document.getElementById("auraDuration");
        const auraDurationValue = document.getElementById("auraDurationValue");
        auraDurationSlider.addEventListener("input", (e) => {
            auraDurationValue.textContent = e.target.value;
        });

        // Chart data and update for pain levels and aura markers
        let lastSevenLogs = [];
        let lastAuraFlags = [];
        function updateChart(pain, auraFlag) {
            lastSevenLogs.unshift(parseInt(pain, 10));
            if (lastSevenLogs.length > 7) lastSevenLogs.pop();
            lastAuraFlags.unshift(auraFlag);
            if (lastAuraFlags.length > 7) lastAuraFlags.pop();
            const barChart = document.getElementById("barChart");
            barChart.innerHTML = "";
            lastSevenLogs.forEach(val => {
                const barEl = document.createElement("div");
                barEl.className = "w-8 bg-blue-500 rounded-t transition-all duration-300";
                const percent = (val / 10) * 100;
                barEl.style.height = percent + "%";
                barChart.appendChild(barEl);
            });
            const auraTimeline = document.getElementById("auraTimeline");
            auraTimeline.innerHTML = "";
            lastAuraFlags.forEach(flag => {
                const marker = document.createElement("div");
                marker.className = "w-8 rounded-t transition-all duration-300";
                marker.style.backgroundColor = flag ? "#3B82F6" : "#6B7280";
                marker.style.height = "100%";
                auraTimeline.appendChild(marker);
            });
        }
        // Initialize charts
        updateChart(0, false);

        // Add log entry to History and store globally
        function addLogEntry(entry) {
            logEntries.push(entry);
            const logContainer = document.getElementById("logHistory");
            const card = document.createElement("div");
            card.className = "log-card";
            let headerColor, typeText;
            if (entry.quick) {
                headerColor = "bg-blue-700";
                typeText = "Quick Log";
            } else {
                headerColor = "bg-green-700";
                typeText = "Advanced Log";
            }
            let details = `
        <div class="log-card-header">
          <span class="font-semibold">${entry.time}</span>
          <span class="log-type ${headerColor}">${typeText}</span>
        </div>
      `;
            if (entry.quick) {
                details += `<p>Default Meds: ${entry.meds}</p>`;
            } else {
                details += `<p>Pain: ${entry.pain}</p>`;
                if (entry.aura) { details += `<p>${entry.aura}</p>`; }
                if (entry.meds) { details += `<p>Meds: ${entry.meds}</p>`; }
                if (entry.triggers) { details += `<p>Triggers: ${entry.triggers}</p>`; }
            }
            card.innerHTML = details;
            logContainer.prepend(card);
        }

        // Save Advanced Log and return to landing page
        function saveAdvancedLog() {
            const dtValue = document.getElementById("dateTime").value;
            const dt = dtValue ? new Date(dtValue).toLocaleString() : new Date().toLocaleString();
            const pain = painSlider.value;
            const meds = selectedMeds.length ? selectedMeds.join(", ") : "No meds";
            const triggers = selectedTriggers.length ? selectedTriggers.join(", ") : "No triggers";
            const auraTypes = selectedAuraTypes.length ? selectedAuraTypes.join(", ") : "No aura types";
            const auraDuration = auraDurationSlider.value;
            const auraDesc = document.getElementById("auraDescription").value || "No description";
            const auraHeadache = document.getElementById("auraHeadache").checked ? "Yes" : "No";
            let auraInfo = "";
            if (selectedAuraTypes.length || auraDuration > 0 || auraDesc.trim() !== "" || document.getElementById("auraHeadache").checked) {
                auraInfo = `Aura: [${auraTypes}] Duration: ${auraDuration} mins, Headache: ${auraHeadache}, Desc: ${auraDesc}`;
            }
            const logEntry = {
                time: dt,
                pain: pain,
                aura: auraInfo,
                meds: meds,
                triggers: triggers,
                quick: false
            };
            addLogEntry(logEntry);
            const auraFlag = selectedAuraTypes.length > 0 || auraDuration > 0 || auraDesc.trim() !== "";
            updateChart(pain, auraFlag);
            alert("Advanced migraine log saved!");
            // Reset fields
            document.getElementById("dateTime").value = "";
            painSlider.value = 5;
            painValue.textContent = "5";
            selectedMeds = [];
            updateSelectedMeds();
            selectedTriggers = [];
            updateSelectedTriggers();
            selectedAuraTypes = [];
            updateSelectedAura();
            auraDurationSlider.value = 0;
            auraDurationValue.textContent = "0";
            document.getElementById("auraDescription").value = "";
            document.getElementById("auraHeadache").checked = false;
            // Return to landing page
            goHome();
        }

        // Enhanced Analytics Dashboard update
        function updateAnalyticsDashboard() {
            let totalLogs = logEntries.length;
            let quickCount = logEntries.filter(log => log.quick).length;
            let advancedCount = totalLogs - quickCount;
            let auraCount = logEntries.filter(log => log.aura && log.aura.trim() !== "").length;
            let advancedLogsWithPain = logEntries.filter(log => !log.quick && log.pain).map(log => parseInt(log.pain, 10));
            let avgPain = advancedLogsWithPain.length ? (advancedLogsWithPain.reduce((a, b) => a + b, 0) / advancedLogsWithPain.length).toFixed(2) : "N/A";
            document.getElementById("totalLogs").textContent = totalLogs;
            document.getElementById("quickLogs").textContent = quickCount;
            document.getElementById("advancedLogs").textContent = advancedCount;
            document.getElementById("auraEvents").textContent = auraCount;
            document.getElementById("avgPain").textContent = avgPain;
        }

        // Generate Detailed Report for sharing
        function generateReport() {
            let reportHTML = "<h3 class='text-xl font-bold mb-2'>Detailed Migraine Report</h3>";
            reportHTML += "<p>This report summarizes your migraine tracking data:</p>";
            const totalLogs = logEntries.length;
            const quickLogs = logEntries.filter(log => log.quick).length;
            const advancedLogs = totalLogs - quickLogs;
            const auraEvents = logEntries.filter(log => log.aura && log.aura.trim() !== "").length;
            const advancedLogsWithPain = logEntries.filter(log => !log.quick && log.pain);
            const avgPain = advancedLogsWithPain.length ? (advancedLogsWithPain.reduce((acc, cur) => acc + parseInt(cur.pain, 10), 0) / advancedLogsWithPain.length).toFixed(2) : "N/A";
            reportHTML += `
        <ul class="list-disc ml-6">
          <li>Total Logs: ${totalLogs}</li>
          <li>Quick Logs (Aura Only): ${quickLogs}</li>
          <li>Advanced Logs: ${advancedLogs}</li>
          <li>Aura Events Recorded: ${auraEvents}</li>
          <li>Average Pain (Advanced Logs): ${avgPain}</li>
        </ul>`;
            reportHTML += "<p><strong>Correlation Analysis:</strong> Based on your aura logs, sleep patterns, weather, stress, and dietary inputs, the strongest correlations appear with [dummy data].</p>";
            reportHTML += "<p><strong>Medication Efficacy:</strong> Your logs indicate that [Medication Name] on average reduces pain by [dummy percentage] over time.</p>";
            reportHTML += "<p>This report is shareable with your healthcare provider for a more informed discussion about your migraine management plan.</p>";
            document.getElementById("detailedReport").innerHTML = reportHTML;
        }
    </script>
</body>

</html>